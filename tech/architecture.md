# ChatGroup - 系统架构总览

## 一、聊天软件的本质

一款聊天软件的核心是 **实时双向通信**。两个客户端（你和朋友）通过一个服务端进行消息中转，服务端负责：

1. 验证身份（谁在发消息）
2. 路由消息（发给谁）
3. 持久化存储（聊天记录不丢失）
4. 推送通知（对方不在线时怎么办）

```
┌──────────┐         ┌──────────────┐         ┌──────────┐
│  Client A │◄──────►│    Server     │◄──────►│  Client B │
│  (你)     │  WS    │  (消息中转)   │  WS    │  (朋友)   │
└──────────┘         └──────┬───────┘         └──────────┘
                            │
                    ┌───────┴───────┐
                    │   Database    │
                    │  (聊天记录)    │
                    └───────┬───────┘
                            │
                    ┌───────┴───────┐
                    │   AI Service  │
                    │  (总结能力)    │
                    └───────────────┘
```

## 二、整体架构选型

采用 **前后端分离** 架构：

| 层级 | 技术 | 说明 |
|------|------|------|
| 前端 | React + TypeScript | 单页应用，负责 UI 渲染和交互 |
| 通信协议 | WebSocket | 实时双向通信 |
| 后端 | Node.js + Express | REST API + WebSocket 服务 |
| 数据库 | PostgreSQL | 用户数据、聊天记录持久化 |
| 缓存 | Redis | 在线状态管理、会话缓存 |
| AI | OpenAI API (或其他 LLM) | 通过唤醒词触发对话总结 |

## 三、核心模块划分

```
chat-group/
├── client/          # 前端应用
├── server/          # 后端服务
├── shared/          # 前后端共享的类型定义
├── tech/            # 技术文档
└── docs/            # 项目文档
```

### 模块职责

| 模块 | 职责 |
|------|------|
| 用户模块 | 注册、登录、JWT 鉴权、个人信息管理 |
| 好友模块 | 好友申请、好友列表、好友状态 |
| 消息模块 | 发送/接收消息、消息存储、历史记录查询 |
| 实时通信模块 | WebSocket 连接管理、心跳检测、断线重连 |
| AI 模块 | 唤醒词检测、上下文收集、调用 LLM 生成总结 |

## 四、数据流

### 普通消息流程

```
1. Client A 输入消息 → 通过 WebSocket 发送到 Server
2. Server 验证身份 → 存入数据库 → 通过 WebSocket 推送给 Client B
3. Client B 收到消息 → 渲染到界面
```

### AI 总结流程

```
1. 用户发送包含唤醒词的消息（如 "@ai 总结一下最近的对话"）
2. Server 检测到唤醒词 → 从数据库取出最近 N 条聊天记录
3. Server 将聊天记录发送给 AI 服务 → 获取总结结果
4. Server 将总结结果作为系统消息推送给聊天中的所有人
```
